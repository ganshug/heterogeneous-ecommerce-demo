---
# =============================================================================
# IBM Db2uCluster — IBM Db2 instance on IBM Power (ppc64le) node
#
# Managed by: IBM Db2 Operator (db2u-operator)
# Namespace:  ecommerce-demo
#
# Node placement: IBM Power (ppc64le) node with workload-type=database label
#
# License:
#   - spec.license.accept: true  (required)
#   - spec.license.value: base64-encoded content of your IBM Db2 license file (.lic)
#     The deploy.sh script will inject this automatically when you provide the
#     license file path via DB2_LICENSE_FILE environment variable or interactive prompt.
#
#     To encode manually:
#       base64 -i /path/to/db2/license.lic
#
#     Keep your license file locally (e.g. db2-dashdb.lic) — it is gitignored.
#
# Database: SHOPDB (db2oltp type)
# Service created by operator: c-db2u-ecommerce-db2u-engn-svc:50000
# Instance user: db2inst1
# Instance password: auto-generated in secret c-db2u-ecommerce-instancepassword
# =============================================================================
apiVersion: db2u.databases.ibm.com/v1
kind: Db2uCluster
metadata:
  name: db2u-ecommerce
  namespace: ecommerce-demo
spec:
  license:
    accept: true
    # value: injected by deploy.sh from DB2_LICENSE_FILE (never committed to git)
    # Keep your license file locally as db2-dashdb.lic (gitignored)
    value: "PLACEHOLDER_INJECTED_BY_DEPLOY_SCRIPT"
  environment:
    dbType: db2oltp
    database:
      name: SHOPDB
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
          - matchExpressions:
              - key: kubernetes.io/arch
                operator: In
                values:
                  - ppc64le
              - key: workload-type
                operator: In
                values:
                  - database
  size: 1
  version: "s11.5.9.0-cn7"
  podConfig:
    db2u:
      resource:
        db2u:
          requests:
            cpu: "2"
            memory: "4Gi"
          limits:
            cpu: "4"
            memory: "8Gi"
  storage:
    - name: meta
      spec:
        accessModes:
          - ReadWriteOnce
        resources:
          requests:
            storage: 10Gi
    - name: data
      spec:
        accessModes:
          - ReadWriteOnce
        resources:
          requests:
            storage: 20Gi
    - name: backup
      spec:
        accessModes:
          - ReadWriteOnce
        resources:
          requests:
            storage: 10Gi
    - name: tempts
      spec:
        accessModes:
          - ReadWriteOnce
        resources:
          requests:
            storage: 10Gi
    - name: archivelogs
      spec:
        accessModes:
          - ReadWriteOnce
        resources:
          requests:
            storage: 10Gi
